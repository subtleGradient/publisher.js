<!DOCTYPE html>  <html> <head>   <title>publisher.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               publisher.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <ul>
<li>Author: <a href="http://ryanflorence.com">Ryan Florence</a></li>
<li>License: MIT Style</li>
<li>Source: <a href="https://github.com/rpflorence/publisher.js">github</a></li>
<li>Issues: <a href="https://github.com/rpflorence/publisher.js/issues">github issues</a></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Please use github issues to report any bugs.  Pull requests welcome!</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>About Pub/Sub in JavaScript</h2>

<p>When moving from bang-it-out domready code to modular development most of
us start to create an unhealthy mess of object dependencies and coupling.
Ideally, you don't want your objects to know about each other.  They need to
exist atomically, for testability, maintainability, and portability.  Enter
Pub/Sub and Aspect Oriented Programming.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Installation - Universal JavaScript support</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p><code>publisher</code> works as an AMD (RequireJS) module, a Node.js module, or a plain
object. If neither AMD nor Node.js environments are detected, the publisher
object is assigned to common global objects like <code>ender</code>, <code>jQuery</code>, <code>$</code>, and
finally to <code>window</code> if nothing else is available.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3>AMD (RequireJS) installation</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Place <code>publisher.js</code> in your application and require it as usual.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">require</span><span class="p">([</span><span class="s1">&#39;path/to/publisher&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">publisher</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* Do stuff with publisher here */</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h3>Node.js Installation</h3>

<p>Install with npm</p>

<pre><code>npm install publisher
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Include like everything else</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">publisher</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;publisher&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>Other browser usage</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>If ender, jQuery, or $ are defined, publisher is assigned to it--otherwise it
hangs from the global object (window).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">ender</span><span class="p">.</span><span class="nx">publisher</span>
<span class="nx">jQuery</span><span class="p">.</span><span class="nx">publisher</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">publisher</span>
<span class="nx">publisher</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>All of the usage is identical among enviornments.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h2>Basic Example</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>Subscribing to a channel</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>First you "subscribe" to a channel, and provide a handler to call when the
channel is published.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">publisher</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;onAwesome&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;awesome&#39;</span><span class="p">);</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h3>Publishing a channel</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>When interesting things happen in your application, you publish the
channel of interest.  Any attached subscription handlers will be called.  In
this case, the console will log "awesome".</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">publisher</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;onAwesome&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h3>Publish with arguments</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>You can also send along some arguments that your
subscriptions may be interested in when you publish.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">publisher</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;onAwesome&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">one</span><span class="p">,</span> <span class="nx">two</span><span class="p">,</span> <span class="nx">foo</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">one</span><span class="p">,</span> <span class="nx">two</span><span class="p">,</span> <span class="nx">foo</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">publisher</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;onAwesome&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h2>Widget example</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>The channel name is simply a string, which is often namespaced to objects in
the applicaton and then the method or action they are taking.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">datepicker</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">open</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(){</span>
    <span class="cm">/* some real code */</span>
    <span class="nx">publisher</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;datepicker/open&#39;</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">select</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">oldValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
        <span class="nx">newValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getSelected</span><span class="p">();</span>
    <span class="cm">/* some real code */</span>
    <span class="nx">publisher</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;datepicker/select&#39;</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">,</span> <span class="nx">oldValue</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">close</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(){</span>
    <span class="cm">/* some real code */</span>
    <span class="nx">publisher</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;datepicker/close&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Subscribe to all the channels</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">publisher</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;datepicker/open&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">blurOtherStuff</span><span class="p">();</span>
<span class="p">});</span>
<span class="nx">publisher</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;datepicker/select&#39;</span><span class="p">,</span> <span class="nx">doSomeThingOnDateSelect</span><span class="p">);</span>
<span class="nx">publisher</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;datepicker/close&#39;</span><span class="p">,</span> <span class="nx">theForm</span><span class="p">.</span><span class="nx">submit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">theForm</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <h2>Creating Individual Publishers</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>While <code>publisher</code> is itself a global publisher, it's also a function allowing
you to turn any object into it's own closed pub/sub system. Publisher extends
the object with publish and subscribe methods.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">datepicker</span> <span class="o">=</span> <span class="nx">publisher</span><span class="p">({</span>
  <span class="nx">open</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p><code>publish</code> is now a method of the object, call it with <code>this.publish</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">select</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">,</span> <span class="nx">oldValue</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">close</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p><code>subscribe</code> is also now a method of the object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">datepicker</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="nx">doSomethingOnOpen</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>This pattern makes extending the behavior of an object trivial.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h2>It's a lot like DOM events ...</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Here we make the window a publisher and publish the 'load' channel in its
<code>onload</code> property method.  Making it behave like <code>addEventListener</code>, except
we also pass along the load time.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">publisher</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">loadTime</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span> <span class="o">-</span> <span class="nx">start</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">loadTime</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}());</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">loadTime</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;loaded in &#39;</span><span class="p">,</span> <span class="nx">loadTime</span><span class="p">,</span> <span class="s1">&#39;ms&#39;</span><span class="p">);</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <h2>Binding the context of handlers to other objects</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Subscription handlers are naturally bound to the object.  We can verify this
behavior in our previous examples.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">publisher</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;onAwesome&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span> <span class="o">===</span> <span class="nx">publisher</span><span class="p">);</span> <span class="c1">//&gt; true</span>
<span class="p">});</span>

<span class="nx">datepicker</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span> <span class="o">===</span> <span class="nx">datepicker</span><span class="p">);</span> <span class="c1">//&gt; true</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Sometimes you may want to change the context of the method, <code>subscribe</code> takes
a third argument to set the context of the subscription</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">publisher</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;onAwesome&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span> <span class="o">===</span> <span class="nx">context</span><span class="p">);</span> <span class="c1">//&gt; true</span>
<span class="p">},</span> <span class="nx">context</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>It's most useful when calling the method of another object</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">publisher</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;onAwesome&#39;</span><span class="p">,</span> <span class="nx">datepicker</span><span class="p">.</span><span class="nx">open</span><span class="p">,</span> <span class="nx">datepicker</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <h2>Subscription Objects</h2>

<p>The <code>subscribe</code> method returns a subscription object allowing you to manage
the subscription with two methods:</p>

<ol>
<li><code>attach</code> and</li>
<li><code>detach</code></li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Store the subscription in a variable</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">subscription</span> <span class="o">=</span> <span class="nx">publisher</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">);</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>console logs 'foo'</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">publisher</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Detach the subscription and console logs nothing</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">subscription</span><span class="p">.</span><span class="nx">detach</span><span class="p">();</span>
<span class="nx">publisher</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Attach the subscription and things are back to normal</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">subscription</span><span class="p">.</span><span class="nx">attach</span><span class="p">();</span>
<span class="nx">publisher</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>The methods return the subscription object so you can detach upon creation</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">subscription2</span> <span class="o">=</span> <span class="nx">publisher</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;foo 2&#39;</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">detach</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <h2>Advising Objects, 100% Decoupled Applications</h2>

<p>Most pub/sub systems require your objects to know about the publisher.  As
with all of the previous examples, we had to reference the publisher object
within our modules.  The goal of pub/sub is to decouple our objects--and
requiring every module to know about <code>publisher</code> is still the same problem.</p>

<p>With <code>publisher.advise</code> you can write truly atomic modules--only publisher
has to know about the objects, and not the other way around.  This allows you
to write modules that only concern themselves with themselves: they don't
know about other modules, and they don't know about <code>publisher</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>While doing this to a built-in isn't really advised, it makes for a great
example.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <h3>publisher.advise and advisor methods</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>First we create an advisor object (for those in the know, we're
using Aspect Oriented Programming techniques to achieve this functionality).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">adviseMath</span> <span class="o">=</span> <span class="nx">publisher</span><span class="p">.</span><span class="nx">advise</span><span class="p">(</span><span class="nb">Math</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Advisor objects have two methods, <code>before</code>, and <code>after</code>.  Supply the name of
the object method you want to be published, and the channel to publish.
It makes sense to put the timing in the channel name (like before, after) but
it doesn't matter what you use.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">adviseMath</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="s1">&#39;pow&#39;</span><span class="p">,</span> <span class="s1">&#39;math:before:pow&#39;</span><span class="p">);</span>
<span class="nx">adviseMath</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;math:after:min&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Whenever <code>Math.pow</code> or <code>Math.min</code> are called, the publisher will publish
the channel associated with the method.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>The arguments to the method being published "before" it's called are passed
into the subscription handler, and the final argument is a reference to the
object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">publisher</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;math:before:pow&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">mathReference</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">mathReference</span> <span class="o">===</span> <span class="nb">Math</span><span class="p">);</span> <span class="c1">//&gt; true</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>The arguments to the subscription handler for methods being published "after"
they are called are the return value of the method a reference to the object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">publisher</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;math:after:min&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">returns</span><span class="p">,</span> <span class="nx">mathReference</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">returns</span><span class="p">);</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>This is an incredibly powerful pattern for connecting the modules in your
application.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 